description "ethercalc"

start on started networking
stop on runlevel [!2345]

env ETHERCALC_HOME=<%= @base_install_dir %>
env ETHERCALC_LOGS=<%= @base_log_dir %>/<%= @ethercalc_user %>
env ETHERCALC_USER=<%= @ethercalc_user %>

respawn

pre-start script
    chdir $ETHERCALC_HOME
    mkdir $ETHERCALC_LOGS                              ||true
    chown -R $ETHERCALC_USER:admin $ETHERCALC_LOGS     ||true
    chmod 0755 $ETHERCALC_LOGS                         ||true
    chown -R $ETHERCALC_USER:admin $ETHERCALC_HOME/var ||true
end script

setuid <%= @ethercalc_user %>
setgid <%= @ethercalc_user %>
limit nofile 8192 16384
script
  cd $ETHERCALC_HOME
  /bin/bash node_modules/ethercalc/bin/run.sh \
                        >> $ETHERCALC_LOGS/access.log \
                        2>> $ETHERCALC_LOGS/error.log
end script
